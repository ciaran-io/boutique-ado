const y=document.querySelector("#stripe_public_key").textContent.slice(1,-1),c=document.querySelector("#client_secret").textContent.slice(1,-1);let s=Stripe(y),p=s.elements();const f=document.querySelector("#card-element"),e=document.querySelector("#payment-form"),v={base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},r=p.create("card",{style:v});r.mount(f);r.addEventListener("change",function(n){const o=document.getElementById("card-errors");n.error?o.textContent=n.error.message:o.textContent=""});e.addEventListener("submit",async function(n){n.preventDefault(),r.update({disabled:!0}),document.querySelector("#submit-button").disabled=!0;const o=!!document.querySelector("#id-save-info").checked,a=document.querySelector('[name="csrfmiddlewaretoken"]').value,l={csrfmiddlewaretoken:a,client_secret:c,save_info:o},i="/checkout/cache_checkout_data/",d={name:e.full_name.value.trim(),phone:e.phone_number.value.trim(),email:e.email.value.trim(),address:{line1:e.street_address1.value.trim(),line2:e.street_address2.value.trim(),city:e.town_or_city.value.trim(),country:e.country.value.trim(),state:e.county.value.trim()}},u={name:e.full_name.value.trim(),phone:e.phone_number.value.trim(),address:{line1:e.street_address1.value.trim(),line2:e.street_address2.value.trim(),city:e.town_or_city.value.trim(),country:e.country.value.trim(),postal_code:e.postcode.value.trim(),state:e.county.value.trim()}};try{await fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a},body:JSON.stringify(l)}).then(()=>{s.confirmCardPayment(c,{payment_method:{card:r,billing_details:d},shipping:u}).then(t=>{if(t.error){const m=document.getElementById("card-errors");m.textContent=t.error.message,r.update({disabled:!1}),document.querySelector("#submit-button").disabled=!1}else t.paymentIntent.status==="succeeded"&&(document.querySelector("#submit-button").disabled=!1,e.submit())})})}catch(t){console.log("There has been a problem with your fetch operation: ",t.message),location.reload()}});
